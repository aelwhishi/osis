{% load staticfiles bootstrap3 %}
{% load i18n %}

{% comment "License" %}
    * OSIS stands for Open Student Information System. It's an application
    * designed to manage the core business of higher education institutions,
    * such as universities, faculties, institutes and professional schools.
    * The core business involves the administration of students, teachers,
    * courses, programs and so on.
    *
    * Copyright (C) 2015-2018 Universit√© catholique de Louvain (http://www.uclouvain.be)
    *
    * This program is free software: you can redistribute it and/or modify
    * it under the terms of the GNU General Public License as published by
    * the Free Software Foundation, either version 3 of the License, or
    * (at your option) any later version.
    *
    * This program is distributed in the hope that it will be useful,
    * but WITHOUT ANY WARRANTY; without even the implied warranty of
    * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    * GNU General Public License for more details.
    *
    * A copy of this license - GNU General Public License - is available
    * at the root of the source code of this program.  If not,
    * see http://www.gnu.org/licenses/.
{% endcomment %}
{% bootstrap_form_errors form_education_group_year %}
{% bootstrap_form_errors form_education_group %}

<form method="post" id="UpdateTrainingForm" data-validate-url="{% url 'validate_education_group_field' 'TRAINING' %}">
    {% csrf_token %}
    <div class="panel panel-default">

        <div class="panel-heading">
            {% include "education_group/blocks/form/create_cancel_buttons.html" %}
        </div>

        <div class="panel-body">
            {% include "education_group/blocks/form/training_tab_identification.html" %}
        </div>

        <div class="panel-footer text-right">
            {% include "education_group/blocks/form/create_cancel_buttons.html" %}
        </div>

    </div>
    <script>
        function validate_field(ev){
            parameters = {
                'academic_year': $("#id_academic_year").val()
            };
            const field_name = $(this).attr('name');

            $parent = $("#UpdateTrainingForm [name='" + field_name + "']").parent();
            $parent.removeClass('has-error');
            $parent.removeClass('has-warning');
            $parent.children(".help-block").remove();

            parameters[field_name] = $(this).val();

            const url = $('#UpdateTrainingForm').data('validate-url') + "?" + $.param(parameters);
            $.ajax({
               url: url
            }).done(function(data) {
                if (!(field_name in data)){
                    return;
                }
                cls = 'has-warning';
                if (data[field_name].level === 'error') {
                    cls = 'has-error'
                }

                $parent.addClass(cls);
                $parent.append("<div class='help-block'>" + data[field_name].msg+ "</div>");
            });
        }

        $(document).ready(function() {
                $("#id_acronym").change(validate_field);
                $("#id_partial_acronym").change(validate_field);

                // Revalidate acronym and partial acronym when modifying academic year
                $("#id_academic_year").change(function () {
                    $("#id_acronym").trigger("change");
                    $("#id_partial_acronym").trigger("change");
                })

            }
        );
    </script>
    {% include "blocks/modal/confirmation_modal.html" %}
</form>
